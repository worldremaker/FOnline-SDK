/**

\~russian @page page_format_fo3d Формат fo3d
\~english @page page_format_fo3d fo3d format
\~

<h2>Общая информация</h2>

Формат fo3d - это текстовый формат описания трехмерных объектов. Редактируется, соответственно, с помощью любого текстового редактора.

По ходу описания будут встречаться ссылки в квадратных скобках - [X], их содержание расположено ниже, перед примерами.

Для передачи данных используются различные модификаторы (ключи и значения). Строка с начала комментария (';', '#') игнорируются до ее окончания. Регистр модификаторов значения не имеет.

Для удобства соотношения некоторых номеров и имен смотрите скрипт _animations.fos.

Условные обозначения передаваемых параметров:\n
FileName - имя файла или пути и файла, путь может быть как полным, так и относительным;\n
IntegerValue - целое значение (0, 1, 22);\n
FloatValue - вещественное значение (0.0, 1.2, 22.1);\n
IntegerArray - массив целых чисел, перечисляется через знак '-', без пробелов, то есть 1-2-5-8;\n
FloatArray - массив вещественных чисел, перечисляется через знак '-', без пробелов, то есть 1.3-2.6-5.2-8.0, так же есть возможность их указания как целые числа (1-2.5-4-7);\n
String - строка, без пробелов;\n
Anim1Weapon [1] - тип оружия для анимации;\n
AnimationName [1] - имя анимации.\n

<h3>Модификаторы</h3>

@code
Model FileName [2]
@endcode
Указывает на базовую модель, поддерживаемые форматы: x, 3ds. Если файл содержит анимацию и дополнительно не указан модификатор model_animation, то будет использоваться данная анимация.

@code
Include FileName From1 To1 From2 To2 FromN ToN
@endcode
Указание файла, который будет вставлен в данном месте.
Данный механизм предназначен для облегчения описания множества однотипных fo3d файлов.
Суть состоит в том, что текст шаблона добавляется в место вызова модификатора, а затем там заменяются определенные идентификаторы. Идентификаторы перечисляются сразу после названия файла шаблона, сначала какое слово будет заменяться, затем на которое. В шаблоне заменяемый идентификатор должен быть расположен между знаками процента ('%%').
Данный модификатор использует всю строку для определения передаваемых параметров, не используйте в ней другие модификаторы.

@code
DisableShadow [2]
@endcode
Отключение отрисовки тени.

@code
CalculateTangentSpace [2]
@endcode
Включение расчета касательного пространства, тангента и бинормали, которые можно использовать в эффектах, см. файл IOStructures.inc.

@code
MoveX, MoveY, MoveZ FloatValue [3][6]
@endcode
Перемещение модели по одной из оси.
По-умолчанию равны 0.0.

@code
RotX, RotY, RotX FloatValue [3][6]
@endcode
Вращение модели по одной из оси. В градусах.
По-умолчанию равны 0.0.

@code
Scale, ScaleX, ScaleY, ScaleZ FloatValue [3][6]
@endcode
Масштабирование модели по одной из оси или сразу по всем трем (Scale).
По-умолчанию равны 1.0.

@code
Speed FloatValue [3][6]
@endcode
Изменение скорости воспроизведения анимации.
По-умолчанию равно 1.0.

@code
DisableLayer IntegerArray [3][8]
@endcode
Включение игнорирование обработки определенных слоев. Значения перечисляются через знак '-'.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
DisableSubset IntegerArray [3][8]
@endcode
Включение игнорирование отрисовки определенных частей модели (материалов). Значения перечисляются через знак '-'.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
Mesh IntegerValue [4]
@endcode
Установка значения текущего меша, на которые будут действовать такие модификаторы, как Texture, Effect.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
Subset IntegerValue [4]
@endcode
Установка значения части меша. При установке отрицательного значения дальнейшие модификаторы будут влиять на все части текущего меша, а не какой-то определенной.

@code
Texture 0..9 FileName [5][9]
@endcode
Установка определенной текстуры для аналогичных переменных в самом эффекте. Но, значение 0 так же указывает на базовую текстуру (цветовую, диффузную) текущего меша и части.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
Effect FileName [5][9]
@endcode
Установка определенного эффекта для текущего выбранного меша и части.

@code
EffDef String String String/FloatArray/IntegerValue
@endcode
Передать определенное значение в эффект. Модификатор действует на эффект, указанный в последнем использованном модификаторе Effect.
Передаются тип (String, Floats, Dword), имя параметра в файле эффекте и значение (в зависимости от типа - строка, массив вещественных чисел, целое значение).\n
Воспринимаются именованные константы из файла DefineNames.fos (для Dword).

@code
Layer IntegerValue [7]
@endcode
Установка определенного слоя.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
Value IntegerValue [7]
@endcode
Установка определенного значения слоя. Когда значение слоя будет равно данному, то все модификаторы, описанные в нем, начинают действовать.\n
Воспринимаются именованные константы из файла DefineNames.fos.

@code
Attach FileName [3][7]
@endcode
Присоединение определенной модели к базовой. Допустимые форматы: x, 3ds, fo3d (то есть возможно рекурсивное подключение, будьте внимательны).
По умолчанию модели линкуются между собой по совпадающим именам костей у обоих. Если требуется точное указание к какой кости линковать рутовую кость, то используйте модификатор Link (см. ниже).

@code
Link String [3][7]
@endcode
Линковка другой модели к текущей, с указанием куда линковать.
То есть {Подключаемая модель Root-Bone} -> {Текущая модель String-Bone}.
Данный модификатор действует только для прикрепленной модели (пока она не будет снята или выбрана другая).

@code
Root [3][7]
@endcode
Установка базовой модели для применения других модификаторов.

@code
Anim Anim1Weapon AnimationName AnimFile String [1]
@endcode
Данный модификатор используется для связывания имен анимаций с индексами, для дальнейшего использования в скриптах.\n
В AnimFile указывается имя файла, откуда она будет взята (если указать “ModelFile”, то поиск будет производиться в файле загружаемой модели)\n
В String указывается имя или порядковый номер анимации.

@code
AnimSpeed Anim1Weapon AnimationName FloatValue [1]
@endcode
Модификатор для указания скорости определенной анимации.

@code
AnimEquals IntegerValue Anim1Weapon AnimationName [1]
@endcode
Добавление алиасов для индексов анимации, чтобы не делать лишний копи-паст.
IntegerValue - номер индекса, 1 или 2;

@code
RenderFrame AnimFile String IntegerValue [2]
@endcode
Отрисовка определенного кадра в спрайт. Используется, когда идет вывод пререндеренной модели.\n
В AnimFile указывается имя файла, откуда она будет взята (если указать “ModelFile”, то поиск будет производиться в файле загружаемой модели)\n
В String указывается имя или порядковый номер анимации. IntegerValue означает процент (0..100) времени анимации, с которого и будет произведен рендер.

@code
RenderFrames AnimFile String IntegerValue IntegerValue [2]
@endcode
Отрисовка определенной анимации в спрайт. Используется, когда идет вывод пререндеренной модели.\n
В AnimFile указывается имя файла откуда она будет взята (если указать “ModelFile”, то поиск будет производиться в файле загружаемой модели)\n
В String указывается имя или порядковый номер анимации. Первый IntegerValue означает процент (0..100) начала времени анимации, второй IntegerValue процент конечного кадра. Может быть использован обратный вывод, когда второе значение меньше первого.
Частота кадров анимации берется из глобальной переменной __Animation3dFPS, если она равна нулю, то берется значение 10.

@code
StopParsing, ContinueParsing
@endcode
Остановка и возобновление обработки файла.

@b Примечания

1. Имена задаются в файле DefineNames.lst
Примеры: 
@code
Anim Anim1Unarmed Anim2PickUp              ModelFile HumM_Def_Una_Pickup_01
Anim Anim1HeavyRifle Anim2Single           anim_HumanMaleRifle.x rifle_shoot
@endcode
2. Данные модификаторы используются только один раз, при многократном использовании данные будут взяты у последнего встретившегося.

3. По умолчанию данные модификаторы влияют на параметры базовой модели (см. Model). Модель меняется в следующих случаях:
- при модификаторе Attach прикрепленная модель становится выбранной;
- при модификаторе Root выбирается базовая модель;
- при модификаторах Layer, Value выбранная модель снимается и другие модификаторы станут работать впустую;
- при некоторых ошибках модель может сняться, например, когда выбираем Root, но стоит нулевое значение Value.

4. Данные модификаторы (Mesh, Subset) сбрасываются при применении модификаторов Root, Layer, Value, Attach. Значения сброса: Mesh = 0, Subset = -1.

5. Данные модификаторы (Texture, Effect) устанавливают необходимое значение (текстуру, эффект) для меша и частей меша установленных модификаторами Mesh и Subset. Сначала надо указать номер меша и части, а потом ставить текстуру или эффект, по умолчанию стоят Mesh = 0 и Subset = -1.

6. При добавлении к имени модификатора знака '+' оно будет добавляться к предыдущему значению, а не присваиваться. Например, ScaleX 1.5 ScaleX 0.5 в итоге дадут 0.5, а ScaleX 1.5 ScaleX+ 0.5 дадут 2.0. Аналогично можно использовать знак '*', что означает умножение на предыдущее значение.

7. Данные модификаторы сейчас применяются для описания изменений модели при изменении значений слоев, которое происходит в скриптах (см. animation3d_process в client_main.fos). Доступно только для трехмерных моделей криттеров.

8. Для чего необходимо отключать определенные слои или части тела - для того, что бы они не конфликтовали между собой при стечении определенных обстоятельств.
Например, если один из слоев отвечает за вывод волос, то в слое головных уборов, при определенных его значениях (большая шляпа закрывающая всю голову), можно отключит слой волос.
Или при выводе сапог могут просвечиваться части ног, то лучше отключить эту часть тела при их одевании.

9. В передаваемом аргументе имени файла можно передать строку "Parent", что будет означать взятие текстуры у базовой модели. Можно дополнительно указывать номер меша и его часть, с которой будет взята текстура - Texture X ParentY-Z, где X номер текстуры, Y номер меша, Z номер части меша; параметры Y-Z опциональны, можно не использовать или использовать частично (то есть Parent, Parent0, Parent-5).

<h2>Примеры:</h2>

\b Parsing
@code
Model model.3ds    ; Загрузка модели
Scale 2.0          ; Увеличиваем в два раза

StopParsing        ; Останавливаем парсинг

 Здесь можем писать что угодно, весь текст будет пропущен.

Scale 0.5          # Не будет обработано, масштаб по-прежнему 2.0

ContinueParsing    # Продолжаем парсинг
Scale+ 1.1         # Добавляем к масштабу, теперь там 3.1
#Scale 1.0         # Обработано не будет, так как находится за комментарием
@endcode

<b>Include</b><br /><br />
some1.fo3d
@code
Include _SomeTemplate.fo3d name some1 number 11
@endcode
some2.fo3d
@code
Include _SomeTemplate.fo3d name some2 number 22
Include _SomeTemplate.fo3d name some2aaa number 33
@endcode
_SomeTemplate.fo3d
@code
Model ATR_%name%_%number%.3ds
@endcode
После применения модификатора Include файлы будут выглядеть следующим образом:
some1.fo3d
@code
Model ATR_some1_11.3ds
@endcode
some2.fo3d
@code
Model ATR_some2_22.3ds
Model ATR_some2aaa_33.3ds
@endcode

<b>Textures, Normal mapping</b><br /><br />
Обычный вывод. "Mesh 0" в данном случае избыточен, он и так по-умолчанию 0, поставлен для примера.\n
Пример находится в "Client\data\art\misc\3d\box\simple.fo3d"
@code
Model Box.3ds
Mesh 0 Subset 0 Texture 0 DED.tga
Mesh 0 Subset 1 Texture 0 DrD.tga
@endcode
Рисование с использованием карты нормалей.\n
Пример находится в "Client\data\art\misc\3d\box\nmap.fo3d"
@code
Model    Box.3ds
CalculateTangentSpace
Subset 0 Texture 0 DED.tga
Subset 0 Texture 1 DEN.tga
Subset 1 Texture 0 DrD.tga
Subset 1 Texture 1 DIntrN.tga
Subset -1 Effect 3D_NormalMapping.fx
@endcode

<b>Frames render</b><br /><br />
Рендер одного спрайта в середине анимации использования. Без тени.\n
Пример находится в "Client\data\art\misc\3d\dclaw\frame.fo3d"
@code
Model ..\..\..\critters\CR_Deathclaw.x
DisableShadow
RenderFrame ModelFile CR_Deathclaw_Def_Una_Use_01 50
@endcode
Рендер анимации, с начала и до конца. Увеличена в два раза.\n
Пример находится в "Client\data\art\misc\3d\dclaw\frames.fo3d"
@code
Model ..\..\..\critters\CR_Deathclaw.x
Scale 2.0
RenderFrames ModelFile CR_Deathclaw_Com_Una_Knock_ProneB_01 0 100
@endcode

<b>Effects</b><br /><br />
Установка эффекта, передача параметров
@code
Model SomeModel.3ds
Effect 3D_MyEffect.fx
 EffDef Floats MyValues     1.4-0.05-6-7.7
 EffDef Floats AnotherValue 59.51243
@endcode
В самом эффекте данные переменные будут иметь вышеуказанные значения
@code
float4 MyValues; // MyValues.x == 1.4f
                 // MyValues.y == 0.05f
                 // MyValues.z == 6.0f
                 // MyValues.w == 7.7f

float AnotherValue; // == 59.51243
@endcode
*/